<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Simulating dose-escalation trials</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Simulating dose-escalation trials</h1>



<p>The <code>escalation</code> package by Kristian Brock. Documentation is hosted at <a href="https://brockk.github.io/escalation/" class="uri">https://brockk.github.io/escalation/</a></p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Before reading this document on simulating dose-finding trials using the <code>escalation</code> package, be sure to check out the <a href="https://brockk.github.io/escalation/">README file</a>. It explains how to compose dose-finding designs using the flexible syntax provided in <code>escalation</code>.</p>
<p>Once you have composed a design that appeals, you will want to learn about its operating performance by running many simulated trials. That is the focus of this vignette. We study simulations because we believe they will predict the performance we can expect in reality. By operating performance, we mean:</p>
<ul>
<li>how often a design recommends a desirable dose;</li>
<li>how many patients are treated;</li>
<li>how many patients are treated at desirable doses;</li>
<li>how many toxicities are seen;</li>
<li>how often the design recommends stopping;</li>
<li>how long trials take;</li>
<li>and so on.</li>
</ul>
</div>
<div id="simulating-trials-in-escalation" class="section level1">
<h1>Simulating trials in <code>escalation</code></h1>
<p>Simulations are run using the <code>simulate_trials</code> function. It can be called on any dose-escalation design. Specifying dose-escalation models is the focus of the package <a href="https://brockk.github.io/escalation/">README file</a>.</p>
<div id="the-simplest-example" class="section level2">
<h2>The simplest example</h2>
<p>Let us start with a very simple example by simulating performance of the 3+3 design in trial of five doses. We need to specify the unknown true probabilities of toxicity at the doses under investigation. Let us investigate:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">true_prob_tox &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.12</span>, <span class="fl">0.27</span>, <span class="fl">0.44</span>, <span class="fl">0.53</span>, <span class="fl">0.57</span>)</a></code></pre></div>
<p>That is, doses 1 and 2 are what most clinicians would describe as tolerable, but doses 3, 4, and 5 are reasonably toxic. The 3+3 design does not target a particular probability of toxicity but empirically, the design tends to target doses with associated toxicity rates of 10-25%<span class="citation">(Korn et al. 1994; Iasonos et al. 2008)</span>.</p>
<p>We must load the <code>escalate</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(escalation)</a></code></pre></div>
<p>For the purposes of illustration, let us simulate a modest number of trials:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">num_sims &lt;-<span class="st"> </span><span class="dv">50</span></a></code></pre></div>
<p>In reality, if we want to have confidence in the simulated results, we would tend to run thousands of iterations <span class="citation">(Wheeler et al. 2019)</span>. We run a small number here so that this vignette compiles quickly.</p>
<p>We run simulations in our scenario using:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">sims &lt;-<span class="st"> </span><span class="kw">get_three_plus_three</span>(<span class="dt">num_doses =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox)</a></code></pre></div>
<p>We set the random number generator seed in the example above so that results are (hopefully) reproducible. Despite setting the seed, the results could still vary across different operating systems or versions of R.</p>
<p>When printed to the screen, the <code>sims</code> object shows some useful summary information:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">sims</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Number of iterations: 50 </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; Number of doses: 5 </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; True probability of toxicity:</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;    1    2    3    4    5 </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 0.12 0.27 0.44 0.53 0.57 </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; Probability of recommendation:</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;   0.08   0.40   0.38   0.10   0.04   0.00 </span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; Probability of administration:</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 0.3466 0.3864 0.2045 0.0455 0.0170 </span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; Sample size:</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;    3.00    9.00    9.00   10.56   12.00   24.00 </span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; Total toxicities:</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt;    2.00    2.00    2.50    2.66    3.00    6.00 </span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt; Trial duration:</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt;    2.70    7.05   10.55   11.20   14.55   27.10</span></a></code></pre></div>
<p>Each of those pieces of information is available progmatically by R functions. For instance, the probability of recommending each dose at the final analysis, inferred from these simulated iterations, is:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">prob_recommend</span>(sims)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;   0.08   0.40   0.38   0.10   0.04   0.00</span></a></code></pre></div>
<p>Bear in mind that these probabilities are the result of a random process. If we run the simulations again with a different seed, we will get different results. Recall also that they are informed by a small number of simulated replicates so there will be considerable uncertainty around these statistics. If we ran a greater number of replicates, there would be less uncertainty.</p>
<p>We infer from the probabilities above that the design is likely to recommend one of the first two doses. However, there is a non-trivial probability that the design will recommend the third dose, which is probably too toxic, or recommend no dose at all.</p>
<p>How many patients are required?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">num_patients</span>(sims))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;    3.00    9.00    9.00   10.56   12.00   24.00</span></a></code></pre></div>
<p>We see that the simulated trials use between 3 and 24 patients, with an expected number of 9-12.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">n_at_recommended_dose</span>(sims))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;   3.000   3.000   3.000   3.783   5.250   6.000       4</span></a></code></pre></div>
<p>Of those, 3-4 at treated at the dose that is eventually recommended.</p>
<p>We can see how many patients are treated at each dose on a trial-by-trial basis. Here are the allocation counts for the first 10 trials:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">n_at_dose</span>(sims) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; # A tibble: 10 x 5</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt;      `1`   `2`   `3`   `4`   `5`</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;  1     3     0     0     0     0</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;  2     6     6     6     6     0</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;  3     6     6     0     0     0</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;  4     3     3     3     0     0</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;  5     3     3     6     3     0</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  6     3     6     0     0     0</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  7     6     3     0     0     0</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  8     3     3     3     0     0</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  9     6     3     6     0     0</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; 10     3     3     3     0     0</span></a></code></pre></div>
<p>This information is aggregated in the probabilities of administation, i.e. the probability that an individual patient is treated at each dose-level:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">prob_administer</span>(sims)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;          1          2          3          4          5 </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; 0.34659091 0.38636364 0.20454545 0.04545455 0.01704545</span></a></code></pre></div>
<p>We might be alarmed to learn that roughly 25% of patients are treated at doses 3-5, the doses we believe to be excessively toxic.</p>
<p>We can also see how many toxicities there were at each dose in the simulated trials (again, here are just the first 10):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">tox_at_dose</span>(sims) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; # A tibble: 10 x 5</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt;      `1`   `2`   `3`   `4`   `5`</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt;  1     2     0     0     0     0</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;  2     1     1     1     3     0</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  3     1     2     0     0     0</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  4     0     0     3     0     0</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;  5     0     0     1     2     0</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;  6     0     2     0     0     0</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;  7     1     2     0     0     0</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;  8     0     0     2     0     0</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  9     1     0     2     0     0</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 10     0     0     2     0     0</span></a></code></pre></div>
<p>and a summary of the total number of toxicities seen in the replicates:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">num_tox</span>(sims))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt;    2.00    2.00    2.50    2.66    3.00    6.00</span></a></code></pre></div>
<p>We expect to see about 2-3 toxicities using this design in this scenario with no iteration producing more than 6 toxicities.</p>
<p>For convenience, simulations can be cast to a <code>tibble</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">as_tibble</span>(sims) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; # A tibble: 12 x 11</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt;    .iteration .depth  time dose    tox     n empiric_tox_rate mean_prob_tox</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;         &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt;  1          1      2   2.7 NoDo…     0     0            0                 0</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt;  2          1      2   2.7 1         2     3            0.667            NA</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt;  3          1      2   2.7 2         0     0          NaN                NA</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt;  4          1      2   2.7 3         0     0          NaN                NA</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt;  5          1      2   2.7 4         0     0          NaN                NA</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt;  6          1      2   2.7 5         0     0          NaN                NA</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt;  7          2      9  27.1 NoDo…     0     0            0                 0</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt;  8          2      9  27.1 1         1     6            0.167            NA</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;  9          2      9  27.1 2         1     6            0.167            NA</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; 10          2      9  27.1 3         1     6            0.167            NA</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; 11          2      9  27.1 4         3     6            0.5              NA</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; 12          2      9  27.1 5         0     0          NaN                NA</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; # … with 3 more variables: median_prob_tox &lt;dbl&gt;, recommended &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; #   true_prob_tox &lt;dbl&gt;</span></a></code></pre></div>
<p>This returns a <code>tidyverse</code> <code>tibble</code>, essentially a fancy data-frame, with the followign columns:</p>
<ul>
<li><code>.iteration</code>, the number of the simulated trial iteration, i.e. <code>.iteration == 1</code> is the first simulated trial, etc;</li>
<li><code>.depth</code>, the cohort number. In the example above we see that the first trial ended after the second cohort but the second trial went as far as cohort 9;</li>
<li><code>time</code>, the time of the analysis, essentially the sum of all of the intra-patient recruitment times;</li>
<li><code>dose</code>, the numerical dose-level or ‘NoDose’ for the option to select no dose;</li>
<li><code>tox</code>, the number of toxicity events seen;</li>
<li><code>n</code>, the number of patients evaluated;</li>
<li><code>empiric_tox_rate</code>, simply <code>tox</code> divided by <code>n</code>;</li>
<li><code>mean_prob_tox</code>, if the method supports statistical estimation, the modelled mean toxicity probability;</li>
<li><code>median_prob_tox</code>, if the method supports statistical estimation, the modelled median toxicity probability;</li>
<li><code>recommended</code>, a logical to show whethet this dose (or stopping) was recommended by this iteration;</li>
<li><code>true_prob_tox</code>, the true yet unknown probability of toxicity in this simulated scenario.</li>
</ul>
<p>Other selection models might add more columns to this object.</p>
<p>Getting the results in <code>tibble</code> format is liberating for analysis and visualisation. For instance, using further <code>tidyverse</code> packages, it is simple to visualise the frequencies of the final model recommendations:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">as_tibble</span>(sims) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(recommended) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">fill =</span> dose)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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gCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKJQL6KHxZWVlP0sehe8KoN4BNL1cQPfdnH4UviuAegfQ9HIB3Tml405s7969tTXBNbSFrbMDmpphBjRsy7HDYesU1buPwhdbk+xcLqBbbpo7/d598TuVw4YNq8jHM+qcHdDUDDOg+f909b1yAd2/KupWzIzfaVy9evV24YdAenRY+gGSObIDmpphBjQ14ptmBX1WG1x92B9HonywTOXzVXzd+LaOe+FvXI7z96B2QIM+q33oPej6eTH33LeSR+G7AihAg8oFNLagdNqd7yePwncFUIAGxYV6gCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKNQToF8yKzUDoABV1PmZAhSg5gEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCgEUoMqMJAoBFKDKjCQKARSgyowkCumAHu6UHdDUDDugqRlmQFMj7IAeDqnZNQWta89IopAOaHWn7ICmZtgBTc0wA5oaYQe0OqQ6VxO0rj0jiUKc4jnFKzOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBFCAKjOSKARQgCozkigEUIAqM5IoBNA+A/T3VgEUoACVAihAAQpQgIYGUIACFKAADQ2gAAUoQAEaGkABClCAAjQ0gAIUoAAFaGgABShAAQrQ0AAKUIACFKChARSgAAUoQEMDKEABClCAhgZQgAIUoAANDaAABShAARoaQAEKUIACNDSAAhSgAAVoaAAFKEABCtDQAApQgAIUoKEBFKAABShAQwMoQI9toOumT5lblzwAKECLDGhNSY1buiB5BFCAFhnQVQ86t68keQRQgBYZ0KWLnIuNjTm3f+zYsYtjnbIDmpphBzQ1wwxoaoQd0NQMM6Cd/9RjeXF5tJxAFzrXkgBaV1FRsa4huGYXvta3thbzEU19ZRuN4Yvz4vJouYCufsC5yhuTRweCO9QWvta31qj5iHpXbT4j1mg+og/9Q161JdVu0cLkUfiuAOodQNPLeZnpxUmT744mD8J3BVDvAJpeTy7UawKodwBND6CqAArQ8ADqG0AzAqh3AE0PoKoACtDwAOobQDMCqHcATQ+gqgAK0PAA6htAMwKodwBND6CqAArQ8ADqG0AzAqh3AE0PoKoACtDwAOpbnwUa3oYf2s/48XrzEVsrWsxnLHnBfMSOinrzGb1UvoD+dIT9jC8/Yj7if4Y1ms+45j7zES8MqzKf0UsBVBVA8x1AVQE03+ULaP379jM+qDUfEd3bZj6j6qD5iMa9ef7u9vDyBZQoKIBSUWcBtGnMY/Hb5UuOHpaW3vTddwwGdSo6f7z1CLfqlmmzPzCd0Pb4LdP+fZfpiESrxti/l+6dTIBe/y/bOwE95NxvvmEtdM7accYT3M6JdW75PNMRW7/d4lZ+13REvD2zrju+gb46tTUBdOWsOXfsPQLUPXFXx+Gh75VPn9/iVt3+nTv39ObUaKM50Fj8q7AX55hPeWxB7g/qUS2zdl1/XAO91t3/8zjQ7Tcfds/f1gF00z93HK69z7k11Tumx9yrt/XqWHugiSFTXzGe8Pg/3m6N58fPuOMd6MEbqpYvWTnfuZprOoBuntxxeGDSvf970K0sue222aW9OjYfQA9Mf8Z8RmzJXNsBr93ljnug7ld3/vwI0K93AF0yv+PQtW578oZdv3ig18fmAeieSRuMJ+x+27nqr9nO+I+pM2eOn5GHC9O9kRVQd/vMJe/Gz+mr5xwB+tL1ezoO12907r7nd/xTnXtrRa+OtQfaNGmb9YhXShvcr6ZbT+EV1Ln3r1nifjFrzrcrE5eZyv71Oztdx2Hl7bNn39/oVk2/ffZ7vTj0YFnpmLIZvfgbdtOaa8rKymbZzlhWOmX2btsRiY5roES9FkCpqAMoFXUApaIOoFTUAdSn9yKbC/0UjtcA6hNACxZAfQJowQJorl7//IDzn4gDrbrurIGXv+ncwnP7nzG50VVNOHXglVsK/eT6fgDNUevgkvpdF8eBXji6qn7GadU7+q2J/W74PHfFhA8bys+M5v4NqEcBNEfrIu86tyKyeWMk/nIZPeknL0c2OBdzWyJVcbynLSv00+vzATRHT/aLObc1snl5v8TPFDmnvK3shJFztsXJtndPoZ9enw+gOVqcAPpmAmhz/OjsO5zb/fBVH1/2dCTP/+rv8RpAc/R8ZKdzSyOb34hscq6+/+KW/fEHp16yNfJS/NcdhX52fT+A5qhh0MSa346Mf5E0cvT+2tLTax/91GutVVfc5C4fubv5RwMqC/30+nwAzdX6of3Pfzay0e0ed8qg0W+7trmDTzzjhoOucsKpJ4/4daGfXN8PoFTUAZSKOoBSUQdQKuoASkUdQKmoAygVdQClog6gVNQBlIq6/wcCWe4sdxJfeQAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
<div id="a-more-complex-example" class="section level2">
<h2>A more complex example</h2>
<p>Let us consider now a model-based dose-finding approach in the same scenario. We will investogate a CRM design, using the model from the <code>dfcrm</code> package. Let us say that we are targeting a 25% toxicity rate:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">target &lt;-<span class="st"> </span><span class="fl">0.25</span></a></code></pre></div>
<p>and that our prior beliefs on the toxicity rates can be represented by:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">skeleton &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</a></code></pre></div>
<p>i.e. we believe the third dose is the dose we seek.</p>
<p>The CRM design as provided by <code>dfcrm</code> offers no native stopping behaviour. Let us say we are willing to use up to 12 patients. How does performance of this simple design compare to the 3+3 above?</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">get_dfcrm</span>(<span class="dt">skeleton =</span> skeleton, <span class="dt">target =</span> target) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">stop_at_n</span>(<span class="dt">n =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">sims</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt; Number of iterations: 50 </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; Number of doses: 5 </span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt; True probability of toxicity:</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;    1    2    3    4    5 </span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; 0.12 0.27 0.44 0.53 0.57 </span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt; Probability of recommendation:</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt;   0.00   0.24   0.50   0.18   0.06   0.02 </span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="co">#&gt; Probability of administration:</span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="co">#&gt;     1     2     3     4     5 </span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="co">#&gt; 0.485 0.225 0.115 0.160 0.015 </span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-22" data-line-number="22"><span class="co">#&gt; Sample size:</span></a>
<a class="sourceLine" id="cb17-23" data-line-number="23"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb17-24" data-line-number="24"><span class="co">#&gt;      12      12      12      12      12      12 </span></a>
<a class="sourceLine" id="cb17-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-26" data-line-number="26"><span class="co">#&gt; Total toxicities:</span></a>
<a class="sourceLine" id="cb17-27" data-line-number="27"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb17-28" data-line-number="28"><span class="co">#&gt;    0.00    3.00    3.00    3.22    4.00    5.00 </span></a>
<a class="sourceLine" id="cb17-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-30" data-line-number="30"><span class="co">#&gt; Trial duration:</span></a>
<a class="sourceLine" id="cb17-31" data-line-number="31"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb17-32" data-line-number="32"><span class="co">#&gt;    5.70    9.85   11.60   12.03   14.12   21.20</span></a></code></pre></div>
<p>The first thing we note is that the CRM design is much less likely to select dose 1 and more likely to select dose 2. If we believe that efficacy is associated with toxicity (and we should if we are using the CRM approach), then this is a good thing.</p>
<p>However, our design has no method to stop if all doses are too toxic. We saw above that the 3+3 design occasionally recommended no dose. Thus, when comparing this CRM design to the 3+3, we are not comparing like with like. It is simple to add a stopping behaviour for excess toxicity:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">get_dfcrm</span>(<span class="dt">skeleton =</span> skeleton, <span class="dt">target =</span> target) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">stop_at_n</span>(<span class="dt">n =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">stop_when_too_toxic</span>(<span class="dt">dose =</span> <span class="dv">1</span>, <span class="dt">tox_threshold =</span> <span class="fl">0.35</span>, <span class="dt">confidence =</span> <span class="fl">0.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">sims</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; Number of iterations: 50 </span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; Number of doses: 5 </span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; True probability of toxicity:</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt;    1    2    3    4    5 </span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; 0.12 0.27 0.44 0.53 0.57 </span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; Probability of recommendation:</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt;   0.02   0.22   0.36   0.30   0.10   0.00 </span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt; Probability of administration:</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt;      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">#&gt; 0.4264 0.1929 0.1574 0.1980 0.0254 </span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt; Sample size:</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="co">#&gt;    3.00   12.00   12.00   11.82   12.00   12.00 </span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="co">#&gt; Total toxicities:</span></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="co">#&gt;    1.00    3.00    3.00    3.34    4.00    6.00 </span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-31" data-line-number="31"><span class="co">#&gt; Trial duration:</span></a>
<a class="sourceLine" id="cb18-32" data-line-number="32"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb18-33" data-line-number="33"><span class="co">#&gt;   2.600   8.825  10.800  11.898  14.575  22.400</span></a></code></pre></div>
<p>We now see some trial iterations that stop and recommend <em>no dose</em> for further study. We cannot see from this scenario whether this design stops frequently enough because an appropriate decision in this scenario is to select one of the lowest two doses. We will research a scenario where all doses are too toxic below.</p>
<p>Given the fixed sample size, how many are treated at the dose that is eventually recommended</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">n_at_recommended_dose</span>(sims))</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt;   0.000   3.000   3.000   4.347   6.000  12.000       1</span></a></code></pre></div>
<p>Similar to the 3+3 design, this CRM design treats 3-4 at the recommended dose. We might want to ensure that there are at least 6 patients at the recommended dose. How would that affect the operating characteristics?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">get_dfcrm</span>(<span class="dt">skeleton =</span> skeleton, <span class="dt">target =</span> target) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">stop_at_n</span>(<span class="dt">n =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">stop_when_too_toxic</span>(<span class="dt">dose =</span> <span class="dv">1</span>, <span class="dt">tox_threshold =</span> <span class="fl">0.35</span>, <span class="dt">confidence =</span> <span class="fl">0.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">demand_n_at_dose</span>(<span class="dt">n =</span> <span class="dv">6</span>, <span class="dt">dose =</span> <span class="st">'recommended'</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox)</a></code></pre></div>
<p>As required, there are now at least 6 patients at the recommended dose:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">n_at_recommended_dose</span>(sims))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co">#&gt;   6.000   6.000   6.000   6.429   6.000  12.000       1</span></a></code></pre></div>
<p>So how does this affect the expected overall sample size?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">sims</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">#&gt; Number of iterations: 50 </span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; Number of doses: 5 </span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; True probability of toxicity:</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt;    1    2    3    4    5 </span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; 0.12 0.27 0.44 0.53 0.57 </span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; Probability of recommendation:</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt;   0.02   0.18   0.54   0.20   0.04   0.02 </span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt; Probability of administration:</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="co">#&gt;      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt; 0.3866 0.2899 0.1387 0.1513 0.0336 </span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co">#&gt; Sample size:</span></a>
<a class="sourceLine" id="cb22-19" data-line-number="19"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="co">#&gt;    6.00   12.00   12.00   14.28   15.00   24.00 </span></a>
<a class="sourceLine" id="cb22-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-22" data-line-number="22"><span class="co">#&gt; Total toxicities:</span></a>
<a class="sourceLine" id="cb22-23" data-line-number="23"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb22-24" data-line-number="24"><span class="co">#&gt;    2.00    3.00    4.00    4.16    5.00   10.00 </span></a>
<a class="sourceLine" id="cb22-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-26" data-line-number="26"><span class="co">#&gt; Trial duration:</span></a>
<a class="sourceLine" id="cb22-27" data-line-number="27"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb22-28" data-line-number="28"><span class="co">#&gt;    3.50   10.82   14.00   14.24   16.95   25.20</span></a></code></pre></div>
<p>Pleasingly, the expected sample size only increases by about 3 patients. Obviously, the maximum increases by 6 patients.</p>
</div>
<div id="further-refinements" class="section level2">
<h2>Further refinements</h2>
<div id="cohort-size" class="section level3">
<h3>Cohort size</h3>
<p>All of the above simulations assume that patients are evaluated in cohorts of three. That assumption is made mainly by convention but naturally it is possible to change that.</p>
<p>We can adjust in simulations the way that simulated patients arrive by providing a custom function via the <code>sample_patient_arrivals</code> parameter. For instance, if we want the model to recommend a new dose after every other patient, we can specify that the <code>sample_patient_arrivals</code> function samples patients in cohorts of two:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">patient_arrivals_func &lt;-<span class="st"> </span><span class="cf">function</span>(current_data) <span class="kw">cohorts_of_n</span>(<span class="dt">n =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">model &lt;-<span class="st"> </span><span class="kw">get_dfcrm</span>(<span class="dt">skeleton =</span> skeleton, <span class="dt">target =</span> target) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">  </span><span class="kw">stop_at_n</span>(<span class="dt">n =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw">stop_when_too_toxic</span>(<span class="dt">dose =</span> <span class="dv">1</span>, <span class="dt">tox_threshold =</span> <span class="fl">0.35</span>, <span class="dt">confidence =</span> <span class="fl">0.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="st">  </span><span class="kw">demand_n_at_dose</span>(<span class="dt">n =</span> <span class="dv">6</span>, <span class="dt">dose =</span> <span class="st">'recommended'</span>)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"></a>
<a class="sourceLine" id="cb23-8" data-line-number="8">sims &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">                  <span class="dt">sample_patient_arrivals =</span> patient_arrivals_func)</a></code></pre></div>
<p>The <code>sample_patient_arrivals</code> function samples the arrival times of new patients for the next interim analysis. The new patients will be added to the existing patients and the model will be fit to the set of all patients. The function that simulates patient arrivals should take as a single parameter a data-frame with one row for each existing patient and columns including <code>cohort</code>, <code>patient</code>, <code>dose</code>, <code>tox</code>, <code>time</code> (and possibly also <code>eff</code> and <code>weight</code>, if a phase I/II or time-to-event method is used). The provision of data on the existing patients to <code>sample_patient_arrivals</code> allows the patient sampling function to be adaptive. The function should return a data-frame with a row for each new patient and a column for <code>time_delta</code>, the time between the arrival of this patient and the previous, like the <code>cohorts_of_n</code> function does:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">cohorts_of_n</span>(<span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co">#&gt; # A tibble: 5 x 1</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt;   time_delta</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; 1        0.1</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt; 2        1.2</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; 3        0.2</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; 4        0.5</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; 5        0.2</span></a></code></pre></div>
</div>
<div id="sampling-the-conclusion-of-partly-observed-trials" class="section level3">
<h3>Sampling the conclusion of partly-observed trials</h3>
<p>The examples demonstrated so far simulate whole trials, from the recruitment and evaluation of the first patient to the last. However, <code>simulate_trials</code> will gladly simulate the culmination of trials that are partly completed. We just have to specify the outcomes already observed via the <code>previous_outcomes</code> parameter. Each simulated trial will commence from those outcomes seen thus far.</p>
<p>For example, let us say that we have observed the first cohort of three already at dose 1, yielding one toxicities and two non-toxicities.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"></a>
<a class="sourceLine" id="cb25-3" data-line-number="3">sims &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">                  <span class="dt">previous_outcomes =</span> <span class="st">'1NTN'</span>)</a></code></pre></div>
<p>The appearance of an early toxicity at dose 1 appear to make it more likely that a low dose will be recommended, as we might expect:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">prob_recommend</span>(sims)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">#&gt;   0.00   0.36   0.60   0.04   0.00   0.00</span></a></code></pre></div>
<p>The <code>previous_outcomes</code> can be described by the outcome string method demonstrated above. They can also be provided via a data-frame, with the following columns:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">previous_outcomes &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  <span class="dt">patient =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  <span class="dt">cohort =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">  <span class="dt">tox =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">  <span class="dt">dose =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">sims &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb27-11" data-line-number="11">                  <span class="dt">previous_outcomes =</span> previous_outcomes)</a></code></pre></div>
<p>We have just described the trial starting point in two different ways. The simulated iterations should produce exactly the same results:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">prob_recommend</span>(sims)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="co">#&gt; NoDose      1      2      3      4      5 </span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="co">#&gt;   0.00   0.36   0.60   0.04   0.00   0.00</span></a></code></pre></div>
</div>
<div id="next-dose" class="section level3">
<h3>Next dose</h3>
<p>Likewise, we can also set the dose to be given to the next patient or cohort of patients by specifying the <code>next_dose</code> parameter. For example, if we want to commence our simulations at dose 5, we would run:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">sims &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_trials, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">                  <span class="dt">next_dose =</span> <span class="dv">5</span>)</a></code></pre></div>
<p>If omitted, the next dose is calculated by invoking the model on the prevailing outcomes, a set that may well be empty. In this setting, most models would opt to start at dose 1 but this may vary by method.</p>
</div>
<div id="all-model-fits" class="section level3">
<h3>All model fits</h3>
<p>In simulations, the dose selection model is fit to the prevailing data at each interim analysis. By default, only the final model fit for each simulated trial is returned. This is done to conserve memory. With a high number of simulated trials, storing many model fits per trial may cause the executing machine to run out of memory. However, you can force this function to retain all model fits by specifying <code>return_all_fits = TRUE</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">get_three_plus_three</span>(<span class="dt">num_doses =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> num_sims, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">                  <span class="dt">return_all_fits =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>We can verify that there are now many analyses per trial:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">sapply</span>(sims<span class="op">$</span>fits, length)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co">#&gt;  [1] 4 3 4 3 6 5 2 4 4 3 5 5 5 4 5 4 3 5 3 6 4 3 3 5 5 5 7 5 3 6 4 4 3 4 5 5 4 5</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co">#&gt; [39] 5 5 4 6 6 3 5 3 5 3 5 5</span></a></code></pre></div>
<p>The multiple fits within a single simulated trial are distinguishable in <code>tibble</code> view via the <code>.depth</code> column:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">as_tibble</span>(sims) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="co">#&gt; # A tibble: 12 x 11</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">#&gt;    .iteration .depth  time dose    tox     n empiric_tox_rate mean_prob_tox</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt;         &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">#&gt;  1          1      1  0    NoDo…     0     0                0             0</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co">#&gt;  2          1      1  0    1         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co">#&gt;  3          1      1  0    2         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="co">#&gt;  4          1      1  0    3         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="co">#&gt;  5          1      1  0    4         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="co">#&gt;  6          1      1  0    5         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="co">#&gt;  7          1      2  4.40 NoDo…     0     0                0             0</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="co">#&gt;  8          1      2  4.40 1         0     3                0            NA</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="co">#&gt;  9          1      2  4.40 2         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="co">#&gt; 10          1      2  4.40 3         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15"><span class="co">#&gt; 11          1      2  4.40 4         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16"><span class="co">#&gt; 12          1      2  4.40 5         0     0              NaN            NA</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17"><span class="co">#&gt; # … with 3 more variables: median_prob_tox &lt;dbl&gt;, recommended &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb32-18" data-line-number="18"><span class="co">#&gt; #   true_prob_tox &lt;dbl&gt;</span></a></code></pre></div>
<p>In contrast to the previous usage of <code>as_tibble(sims)</code>, we see that there are now model fits at multiple fits within each simulated trial <code>.iteration</code>. The rows at <code>.depth == 1</code> reflect the initial model fit before any new patients are recruited, essentially the starting point of this simulated trial. The rows at <code>.depth == 2</code> show the model fit after the first cohort of patients, and so on.</p>
</div>
<div id="big-trials" class="section level3">
<h3>Big trials</h3>
<p>Designs must eventually choose to stop the trial. However, some selectors, like those derived from <code>get_dfcrm</code>, offer no default stopping method. You may need to append stopping behaviour to your selector via something like <code>stop_at_n</code> or <code>stop_when_n_at_dose</code>, etc. To safeguard against simulating runaway trials that never end, the <code>simulate_trials</code> function will halt a simulated trial after 30 invocations of the dose-selection decision. To breach this limit, specify <code>i_like_big_trials = TRUE</code> in the function call. However, when you forego the safety net, the onus is on you to write selectors that will eventually stop the trial, so be careful!</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">get_dfcrm</span>(<span class="dt">skeleton =</span> skeleton, <span class="dt">target =</span> target) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">stop_at_n</span>(<span class="dt">n =</span> <span class="dv">99</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw">simulate_trials</span>(<span class="dt">num_sims =</span> <span class="dv">1</span>, <span class="dt">true_prob_tox =</span> true_prob_tox,</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">                  <span class="dt">i_like_big_trials =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">num_patients</span>(sims)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="co">#&gt; [1] 99</span></a></code></pre></div>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-Iasonos2008">
<p>Iasonos, Alexia, Andrew S Wilton, Elyn R Riedel, Venkatraman E Seshan, and David R Spriggs. 2008. “A Comprehensive Comparison of the Continual Reassessment Method to the Standard 3 + 3 Dose Escalation Scheme in Phase I Dose-Finding Studies.” <em>Clinical Trials (London, England)</em> 5 (5): 465–77. <a href="https://doi.org/10.1177/1740774508096474">https://doi.org/10.1177/1740774508096474</a>.</p>
</div>
<div id="ref-korn1994">
<p>Korn, Edward L., Douglas Midthune, T. Timothy Chen, Lawrence V. Rubinstein, Michaele C. Christian, and Richard M. Simon. 1994. “A Comparison of Two Phase I Trial Designs.” <em>Statistics in Medicine</em> 13 (18): 1799–1806. <a href="https://doi.org/10.1002/sim.4780131802">https://doi.org/10.1002/sim.4780131802</a>.</p>
</div>
<div id="ref-wheelerHowDesignDosefinding2019">
<p>Wheeler, Graham M., Adrian P. Mander, Alun Bedding, Kristian Brock, Victoria Cornelius, Andrew P. Grieve, Thomas Jaki, et al. 2019. “How to Design a Dose-Finding Study Using the Continual Reassessment Method.” <em>BMC Medical Research Methodology</em> 19 (1). <a href="https://doi.org/10.1186/s12874-018-0638-z">https://doi.org/10.1186/s12874-018-0638-z</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
